/* ==========================================================================
   1. RESET & VARIABLES
   ========================================================================== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
    /* Colors */
    --primary-hue: 245;
    --primary: hsl(var(--primary-hue), 75%, 55%);
    --primary-dark: hsl(var(--primary-hue), 70%, 45%);
    --primary-light: hsl(var(--primary-hue), 90%, 96%);
    --secondary: #0ea5e9;
    --accent: #f59e0b;

    /* Surfaces */
    --bg-app: #f0f2f5;
    --bg-sidebar: #ffffff;
    --bg-chat: #efeae2;
    --bg-message-sent: var(--primary);
    --bg-message-received: #ffffff;
    --text-main: #111b21;
    --text-secondary: #667781;
    --text-inverse: #ffffff;
    --border-light: #e9edef;
    --divider: #e0e0e0;
    
    /* Typography */
    --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    
    /* Spacing */
    --space-s: 8px;
    --space-m: 16px;
    --space-l: 24px;
    --radius-bubble: 16px;
    --radius-ui: 12px;
}

/* Dark Mode */
@media (prefers-color-scheme: dark) {
    :root {
        --bg-app: #0c1317;
        --bg-sidebar: #111b21;
        --bg-chat: #0b141a;
        --bg-message-received: #202c33;
        --text-main: #e9edef;
        --text-secondary: #8696a0;
        --border-light: #202c33;
        --divider: #2a3942;
        --primary-light: #1d2c35;
    }
}

/* ==========================================================================
   2. BASE STYLES
   ========================================================================== */
body {
    font-family: var(--font-main);
    background-color: var(--bg-app);
    color: var(--text-main);
    height: 100vh;
    height: 100dvh; /* Dynamic viewport height for mobile */
    overflow: hidden;
    -webkit-font-smoothing: antialiased;
}

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background-color: rgba(0,0,0,0.2); border-radius: 20px; }
@media (prefers-color-scheme: dark) { ::-webkit-scrollbar-thumb { background-color: rgba(255,255,255,0.1); } }

.icon { width: 24px; height: 24px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
.icon-logo { width: 32px; height: 32px; color: var(--text-main); z-index: 2; }
a { color: var(--primary); text-decoration: none; font-weight: 500; transition: opacity 0.2s; }
a:hover { opacity: 0.8; }

/* ==========================================================================
   3. LAYOUT (AUTH)
   ========================================================================== */
.auth-container {
    position: fixed; inset: 0; z-index: 100;
    display: flex; align-items: center; justify-content: center;
    background-color: var(--bg-app); overflow: hidden;
}

.orb {
    position: absolute; border-radius: 50%; filter: blur(80px);
    opacity: 0.6; z-index: -1;
    animation: float 10s ease-in-out infinite;
}
.orb-1 { width: 400px; height: 400px; background: var(--primary); top: -100px; left: -100px; animation-delay: 0s; }
.orb-2 { width: 300px; height: 300px; background: var(--secondary); bottom: -50px; right: -50px; animation-delay: -5s; }

.auth-card {
    width: 100%; max-width: 420px; padding: 40px;
    background: rgba(255, 255, 255, 0.75);
    backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 16px;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    text-align: center; margin: 16px;
    opacity: 0; transform: translateY(20px);
    animation: slideUpFade 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}
@media (prefers-color-scheme: dark) { .auth-card { background: rgba(30, 41, 59, 0.75); border: 1px solid rgba(255, 255, 255, 0.08); } }

.logo-container { margin-bottom: 24px; display: flex; justify-content: center; position: relative; width: 64px; height: 64px; margin: 0 auto 24px auto; }
.logo-ring { position: absolute; inset: 0; border-radius: 50%; background: conic-gradient(from 180deg at 50% 50%, var(--primary) 0deg, var(--secondary) 180deg, var(--primary) 360deg); opacity: 0.8; }
.brand-title { font-size: 2.25rem; font-weight: 800; margin-bottom: 8px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.brand-tagline { font-size: 1.125rem; color: var(--text-secondary); font-weight: 500; margin-bottom: 48px; }

/* ==========================================================================
   4. LAYOUT (APP GRID)
   ========================================================================== */
.app-container {
    display: grid; grid-template-columns: 380px 1fr; 
    height: 100vh;
    height: 100dvh;
    opacity: 0; transition: opacity 0.3s; display: none;
}
.app-container.active { opacity: 1; display: grid; }

.sidebar {
    background-color: var(--bg-sidebar); border-right: 1px solid var(--border-light);
    display: flex; flex-direction: column; height: 100%;
}

.chat-area {
    display: flex; flex-direction: column;
    background-color: var(--bg-chat);
    /* Subtle Pattern */
    background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23000000' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
    height: 100%; position: relative;
}
@media (prefers-color-scheme: dark) {
    .chat-area { background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E"); }
}

.active-chat-container { display: none; flex-direction: column; height: 100%; }

/* Responsive Logic */
@media (max-width: 900px) {
    .app-container { grid-template-columns: 1fr; }
    .app-container:not(.chat-active) .sidebar { display: flex; }
    .app-container:not(.chat-active) .active-chat-container { display: none; }
    .app-container.chat-active .sidebar { display: none; }
    .app-container.chat-active .active-chat-container { display: flex; }
    .mobile-back-btn { display: flex !important; }
}
@media (min-width: 901px) { .mobile-back-btn { display: none; } }

@keyframes slideUpFade { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
@keyframes float { 0% { transform: translate(0, 0); } 50% { transform: translate(-20px, 20px); } 100% { transform: translate(0, 0); } }

/* ==========================================================================
   5. COMPONENTS (Forms, Buttons, Messages)
   ========================================================================== */
/* Forms */
.input-group { text-align: left; margin-bottom: 24px; }
.label { font-size: 0.875rem; font-weight: 600; color: var(--text-main); margin-left: 4px; display: block; margin-bottom: 4px; }
.input { width: 100%; padding: 12px 16px; border-radius: 8px; border: 1px solid var(--border-light); background: rgba(255, 255, 255, 0.5); font-size: 16px; color: var(--text-main); transition: all 0.2s; }
@media (prefers-color-scheme: dark) { .input { background: rgba(0, 0, 0, 0.2); color: var(--text-main); } }
.input:focus { background: var(--bg-sidebar); border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15); outline: none; }

.btn { border: none; cursor: pointer; font-family: inherit; }
.btn-primary { background: var(--primary); color: white; padding: 16px; border-radius: 8px; font-weight: 600; font-size: 16px; transition: background 0.2s; width: 100%; }
.btn-primary:hover { background-color: var(--primary-dark); }
.btn-primary:active { transform: scale(0.98); }
.btn-icon { width: 40px; height: 40px; border-radius: 50%; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.2s; }
.btn-icon:hover { background-color: var(--primary-light); }
.btn-icon:active { transform: scale(0.95); }

/* Sidebar */
.sidebar-header { height: 60px; padding: 10px 16px; display: flex; align-items: center; justify-content: space-between; background-color: var(--bg-sidebar); }
.user-profile-thumb { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
.icon-group { display: flex; gap: 4px; }
.search-container { padding: 8px 16px; border-bottom: 1px solid var(--border-light); }
.search-input { width: 100%; background-color: var(--bg-app); border: none; padding: 8px 32px 8px 12px; border-radius: 8px; font-size: 14px; color: var(--text-main); outline: none; }
.contact-list { flex: 1; overflow-y: auto; }

.contact-item { display: flex; align-items: center; padding: 12px 16px; cursor: pointer; border-bottom: 1px solid transparent; transition: background-color 0.2s; }
.contact-item:hover { background-color: var(--bg-app); }
.contact-item.active { background-color: var(--primary-light); }
.contact-avatar { width: 49px; height: 49px; border-radius: 50%; margin-right: 15px; flex-shrink: 0; object-fit: cover; }
.contact-info { flex: 1; overflow: hidden; display: flex; flex-direction: column; justify-content: center; }
.contact-top { display: flex; justify-content: space-between; margin-bottom: 3px; }
.contact-name { font-size: 16px; font-weight: 500; color: var(--text-main); }
.contact-time { font-size: 12px; color: var(--text-secondary); }
.contact-bottom { display: flex; justify-content: space-between; align-items: center; }
.contact-preview { font-size: 14px; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px; }
.unread-badge { background-color: var(--primary); color: white; font-size: 11px; font-weight: 700; min-width: 20px; height: 20px; border-radius: 10px; display: flex; align-items: center; justify-content: center; padding: 0 6px; }

/* Chat */
.chat-header { height: 60px; background-color: var(--bg-sidebar); padding: 0 16px; display: flex; align-items: center; justify-content: space-between; border-left: 1px solid var(--border-light); }
.chat-user-info { display: flex; align-items: center; cursor: pointer; }
.chat-avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 12px; object-fit: cover; }
.chat-details { display: flex; flex-direction: column; }
.chat-name { font-size: 16px; font-weight: 600; color: var(--text-main); }
.chat-status { font-size: 12px; color: var(--text-secondary); }

.messages-wrapper { flex: 1; overflow-y: auto; padding: 20px 60px; display: flex; flex-direction: column; }

.date-divider { align-self: center; background-color: var(--divider); color: var(--text-main); padding: 6px 12px; border-radius: 8px; font-size: 12px; margin: 10px 0; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
@media (prefers-color-scheme: dark) { .date-divider { background-color: var(--bg-sidebar); } }

.message { max-width: 65%; margin-bottom: 8px; display: flex; flex-direction: column; position: relative; font-size: 14.2px; line-height: 19px; box-shadow: 0 1px 0.5px rgba(0,0,0,0.13); }
.message-bubble { padding: 6px 10px 8px 10px; position: relative; word-wrap: break-word; }
.message.received { align-self: flex-start; }
.message.received .message-bubble { background-color: var(--bg-message-received); color: var(--text-main); border-radius: var(--radius-bubble) var(--radius-bubble) var(--radius-bubble) 2px; }
.message.sent { align-self: flex-end; }
.message.sent .message-bubble { background-color: var(--bg-message-sent); color: var(--text-inverse); border-radius: var(--radius-bubble) var(--radius-bubble) 2px var(--radius-bubble); }

.message-time { display: inline-block; margin-top: 4px; font-size: 11px; float: right; margin-left: 8px; color: inherit; opacity: 0.8; }
.message.received .message-time { color: var(--text-secondary); float: right; margin-left: 10px; }
.message.sent .message-time { color: rgba(255,255,255,0.8); }
.icon-tick { width: 14px; height: 14px; fill: currentColor; display: inline-block; margin-right: 2px; vertical-align: middle; }
.tick-blue { color: #53bdeb; }

.chat-footer { 
    background-color: var(--bg-sidebar); 
    padding: 10px 16px; 
    display: flex; 
    align-items: center; 
    gap: 12px; 
}

/* Mobile keyboard support */
@supports (-webkit-touch-callout: none) {
    .chat-footer {
        padding-bottom: max(10px, env(safe-area-inset-bottom));
    }
}

.input-box-wrapper { flex: 1; background-color: var(--bg-app); border-radius: 8px; padding: 9px 12px; display: flex; align-items: center; }
.msg-input { flex: 1; border: none; background: transparent; outline: none; font-size: 15px; color: var(--text-main); }
.send-btn { width: 45px; height: 45px; border-radius: 50%; background-color: var(--primary); color: white; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: transform 0.1s; }
.send-btn:active { transform: scale(0.95); }

/* Empty State */
.empty-state-bg { background-color: var(--bg-sidebar); border-bottom: 6px solid var(--primary-dark); text-align: center; padding-top: 100px; height: 100%; display: flex; flex-direction: column; align-items: center; }
.empty-title { margin-top: 20px; font-weight: 300; color: #41525d; }
@media (prefers-color-scheme: dark) { .empty-title { color: var(--text-main); } }
.empty-subtitle { margin-top: 10px; color: var(--text-secondary); font-size: 14px; }
.empty-illustration { opacity: 0.6; margin-bottom: 20px; }

/* Typing */
.typing-indicator { display: flex; gap: 4px; padding: 12px 16px; background: var(--bg-sidebar); border-radius: 18px; width: fit-content; margin-bottom: 10px; box-shadow: 0 1px 0.5px rgba(0,0,0,0.13); }
@media (prefers-color-scheme: dark) { .typing-indicator { background: var(--bg-message-received); } }
.typing-dot { width: 6px; height: 6px; background: var(--text-secondary); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
.typing-dot:nth-child(1) { animation-delay: -0.32s; }
.typing-dot:nth-child(2) { animation-delay: -0.16s; }
@keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

.auth-links { margin-top: 32px; font-size: 0.875rem; color: var(--text-secondary); }

/* ==========================================================================
   6. RESPONSIVE OPTIMIZATIONS
   ========================================================================== */
@media (max-width: 900px) { 
    .messages-wrapper { padding: 15px 16px; } 
}

@media (max-width: 600px) {
    .messages-wrapper {
        padding: 15px 12px;
    }
    
    .message {
        max-width: 80%;
    }
    
    .contact-preview {
        max-width: 140px;
    }
    
    .auth-card {
        padding: 24px;
        margin: 12px;
    }
    
    .brand-title {
        font-size: 1.75rem;
    }
    
    .brand-tagline {
        font-size: 1rem;
    }
}

@media (max-width: 400px) {
    .messages-wrapper {
        padding: 12px 8px;
    }
    
    .chat-header,
    .sidebar-header {
        height: 56px;
        padding: 8px 12px;
    }
    
    .user-profile-thumb,
    .chat-avatar {
        width: 36px;
        height: 36px;
    }
    
    .contact-avatar {
        width: 44px;
        height: 44px;
        margin-right: 12px;
    }
    
    .btn-icon {
        width: 36px;
        height: 36px;
    }
    
    .icon {
        width: 20px;
        height: 20px;
    }
    
    .auth-card {
        padding: 20px;
    }
    
    .brand-title {
        font-size: 1.5rem;
    }
}